{% extends 'base.html' %}

{% block title %}Driving Direction - GeoGuessr Trainer{% endblock %}

{% block extra_css %}
<style>
    .drill-container {
        max-width: 600px;
        margin: 1rem auto;
        padding: 0 1rem;
    }

    .stats-container {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }

    .stat-box {
        padding: 0.4rem 0.8rem;
        background-color: #f8f9fa;
        border-radius: 5px;
        text-align: center;
    }

    .stat-label {
        font-size: 0.75rem;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .stat-value {
        font-size: 1.2rem;
        font-weight: bold;
        color: #2c3e50;
    }

    .flag-container {
        text-align: center;
        margin-bottom: 1rem;
    }

    .flag-image {
        max-width: 100%;
        height: auto;
        max-height: 200px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .country-name {
        font-size: 1.8rem;
        font-weight: bold;
        margin: 0.75rem 0 0.5rem 0;
        color: #2c3e50;
        text-align: center;
    }

    .question-text {
        font-size: 1rem;
        color: #6c757d;
        margin-bottom: 1rem;
        text-align: center;
    }

    .answer-buttons {
        display: flex;
        gap: 0.75rem;
        justify-content: center;
        margin-bottom: 1rem;
    }

    .answer-btn {
        font-size: 1rem;
        padding: 0.75rem 2rem;
        border-radius: 8px;
        transition: all 0.2s ease;
        font-weight: 500;
        flex: 1;
        max-width: 160px;
    }

    .answer-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .btn-left {
        background-color: #3498db;
        border-color: #3498db;
    }

    .btn-left:hover {
        background-color: #2980b9;
        border-color: #2980b9;
    }

    .btn-right {
        background-color: #e74c3c;
        border-color: #e74c3c;
    }

    .btn-right:hover {
        background-color: #c0392b;
        border-color: #c0392b;
    }

    .result-container {
        display: none;
        margin-top: 1rem;
        padding: 1rem;
        text-align: center;
    }

    .result-container.correct {
        background-color: #d4edda;
        border: 2px solid #28a745;
    }

    .result-container.incorrect {
        background-color: #f8d7da;
    }

    .result-icon {
        font-size: 2rem;
        margin-bottom: 0.25rem;
    }

    .result-text {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }

    .result-explanation {
        font-size: 0.9rem;
        margin-bottom: 0.75rem;
    }

    .next-btn {
        font-size: 0.95rem;
        padding: 0.5rem 1.5rem;
    }

    .card {
        border: none;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .card-body {
        padding: 1.5rem;
    }

    .back-link {
        text-align: center;
        margin-top: 1rem;
    }

    @media (max-width: 576px) {
        .drill-container {
            padding: 0 0.5rem;
        }

        .country-name {
            font-size: 1.5rem;
        }

        .answer-btn {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
        }

        .flag-image {
            max-height: 150px;
        }

        .stats-container {
            font-size: 0.85rem;
            gap: 0.5rem;
        }

        .stat-value {
            font-size: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container drill-container">
    <!-- Stats -->
    <div class="stats-container">
        <div class="stat-box">
            <div class="stat-label">Correct</div>
            <div class="stat-value" id="correct-count">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Total</div>
            <div class="stat-value" id="total-count">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Accuracy</div>
            <div class="stat-value" id="accuracy">0%</div>
        </div>
    </div>

    <!-- Main Drill Card -->
    <div class="card">
        <div class="card-body">
            <!-- Flag Display -->
            <div class="flag-container">
                <img src="{{ country.flag_url }}" alt="{{ country.name }} flag" class="flag-image" id="flag-image">
            </div>

            <!-- Country Name -->
            <h1 class="country-name" id="country-name">{{ country.name }}</h1>

            <!-- Question -->
            <p class="question-text">Which side of the road?</p>

            <!-- Answer Buttons -->
            <div class="answer-buttons" id="answer-buttons">
                <button class="btn btn-left answer-btn text-white" onclick="checkAnswer('LHS')">
                    ← Left
                </button>
                <button class="btn btn-right answer-btn text-white" onclick="checkAnswer('RHS')">
                    Right →
                </button>
            </div>

            <!-- Result Display -->
            <div class="result-container" id="result-container">
                <div class="result-icon" id="result-icon"></div>
                <div class="result-text" id="result-text"></div>
                <div class="result-explanation" id="result-explanation"></div>
                <button class="btn btn-primary next-btn" onclick="nextQuestion()">
                    Next →
                </button>
            </div>

        </div>
    </div>

    <!-- Back to Home -->
    <div class="back-link">
        <a href="{% url 'home' %}" class="btn btn-sm btn-outline-secondary">
            ← Back to Home
        </a>
    </div>
</div>

<!-- Hidden data for JavaScript -->
<div id="country-data" data-country="{{ country.name }}" data-drive-side="{{ country.drive_side }}"
    data-flag="{{ country.flag_url }}" style="display: none;">
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Session stats
    let correctAnswers = parseInt(sessionStorage.getItem('correctAnswers') || '0');
    let totalQuestions = parseInt(sessionStorage.getItem('totalQuestions') || '0');

    // Update stats display
    function updateStats() {
        document.getElementById('correct-count').textContent = correctAnswers;
        document.getElementById('total-count').textContent = totalQuestions;

        const accuracy = totalQuestions > 0
            ? Math.round((correctAnswers / totalQuestions) * 100)
            : 0;
        document.getElementById('accuracy').textContent = accuracy + '%';
    }

    // Initialize stats on page load
    updateStats();

    // Get current country data
    const countryData = document.getElementById('country-data');
    const correctAnswer = countryData.dataset.driveSide;
    let hasAnswered = false;

    function checkAnswer(selectedSide) {
        document.getElementById('answer-buttons').style.display = 'none';
        if (hasAnswered) return;
        hasAnswered = true;

        // Update stats
        totalQuestions++;
        const isCorrect = selectedSide === correctAnswer;
        if (isCorrect) {
            correctAnswers++;
        }

        // Save to session storage
        sessionStorage.setItem('correctAnswers', correctAnswers);
        sessionStorage.setItem('totalQuestions', totalQuestions);
        updateStats();

        // Disable buttons
        const buttons = document.querySelectorAll('.answer-btn');
        buttons.forEach(btn => btn.disabled = true);

        // Show result
        const resultContainer = document.getElementById('result-container');
        const resultIcon = document.getElementById('result-icon');
        const resultText = document.getElementById('result-text');
        const resultExplanation = document.getElementById('result-explanation');

        const sideName = correctAnswer === 'LHS' ? 'left' : 'right';

        if (isCorrect) {
            resultContainer.className = 'result-container correct';
            resultContainer.style.display = 'block';
            resultIcon.textContent = '✓';
            resultIcon.style.color = '#28a745';
            resultText.textContent = 'Correct!';
            resultText.style.color = '#155724';
            resultExplanation.innerHTML = `<span style="color: #155724;">${countryData.dataset.country} drives on the ${sideName}</span>`;
        } else {
            resultContainer.className = 'result-container incorrect';
            resultContainer.style.display = 'block';
            resultIcon.textContent = '✗';
            resultIcon.style.color = '#dc3545';
            resultText.textContent = 'Incorrect';
            resultText.style.color = '#721c24';
            resultExplanation.innerHTML = `<span style="color: #721c24;">${countryData.dataset.country} drives on the <strong>${sideName}</strong></span>`;
        }
    }

    function nextQuestion() {
        window.location.reload();
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function (e) {
        if (hasAnswered) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            }
        } else {
            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
                e.preventDefault();
                checkAnswer('LHS');
            } else if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
                e.preventDefault();
                checkAnswer('RHS');
            }
        }
    });
</script>
{% endblock %}